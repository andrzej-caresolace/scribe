# Social Scribe ü§ñüìù‚ú®

**Stop manually summarizing meetings and drafting social media posts! Social Scribe leverages AI to transform your meeting transcripts into engaging follow-up emails and platform-specific social media content, ready to share.**

Social Scribe is a powerful Elixir and Phoenix LiveView application designed to connect to your calendars, automatically send an AI notetaker to your virtual meetings, provide accurate transcriptions via Recall.ai, and then utilize Google Gemini's advanced AI to draft compelling follow-up emails and social media posts through user-defined automation rules. This project was developed with significant AI assistance, as encouraged by the challenge, to rapidly build a feature-rich application.

---

## üåü Key Features Implemented

* **Google Calendar Integration:**
    * Seamlessly log in with your Google Account.
    * Connect multiple Google accounts to aggregate events from all your calendars.
    * View your upcoming calendar events directly within the app's dashboard.
* **Automated Meeting Transcription with Recall.ai:**
    * Toggle a switch for any calendar event to have an AI notetaker attend.
    * The app intelligently parses event details (description, location) to find Zoom or Google Meet links.
    * Recall.ai bot joins meetings a configurable number of minutes before the start time (currently default, setting to be added to UI).
    * **Bot ID Management:** Adheres to challenge constraints by tracking individually created `bot_id`s and not using the general `/bots` endpoint.
    * **Polling for Media:** Implements a robust polling mechanism (via Oban) to check bot status and retrieve transcripts/media, as webhooks cannot be used with the shared API key.
* **AI-Powered Content Generation (Google Gemini):**
    * Automatically drafts a follow-up email summarizing key discussion points and action items from the meeting transcript.
    * **Custom Automations:** Users can create, view, and manage automation templates, defining custom prompts, target platforms (LinkedIn, Facebook), and descriptions to generate specific marketing content or other post types.
* **Social Media Integration & Posting:**
    * Securely connect LinkedIn and Facebook accounts via OAuth on the Settings page.
    * **Direct Posting:** Generated content can be posted directly to the user's connected LinkedIn profile or a user-managed Facebook Page.
* **Meeting Management & Review:**
    * View a list of past processed meetings, showing attendees, start time, and platform logo (platform logo to be enhanced).
    * Click into any past meeting to view its full transcript, the AI-generated follow-up email draft, and a list of social media posts generated by configured automations.
    * **Copy & Post Buttons:** Social media drafts are presented with a "Copy" button (implemented via JS Hooks) for easy content reuse and direct "Post" buttons for integrated platforms.
* **Salesforce Integration:**
    * Connect Salesforce accounts via OAuth 2.0 on the Settings page.
    * Search, view, and update Salesforce contacts from meeting detail pages.
    * Create **new** contacts directly in Salesforce when a meeting participant doesn't exist yet ‚Äî pre-filled with AI-extracted info from the transcript.
    * Automatic token refresh via a dedicated Oban worker.
* **CRM Copilot (AI Chat Assistant):**
    * Conversational AI interface at `/dashboard/copilot` for interacting with CRM data.
    * `@`-mention contacts from any connected CRM (HubSpot, Salesforce) in the chat.
    * Persistent sessions and turns stored in the database.
    * Source icons indicate which CRM a contact comes from.
    * "Add context" button for quick `@`-mention insertion.
* **Contact Creation from Meetings:**
    * When searching for a meeting participant in HubSpot or Salesforce and no match is found, a "Create new contact from meeting" button appears.
    * The AI extracts contact details (name, email, phone, company, etc.) from the transcript and pre-fills all fields.
    * Users review and selectively apply fields before creating the contact in their CRM.
* **Modern Tech Stack & Background Processing:**
    * Built with Elixir & Phoenix LiveView for a real-time, interactive experience.
    * Utilizes Oban for robust background job processing (calendar syncing, bot status polling, AI content generation).
    * Secure credential management for all connected services using Ueberauth.

---

## App Flow

* **Login With Google and Meetings Sync:**
    [![Auth Flow](https://img.youtube.com/vi/RM7YSlu5ZDg/hqdefault.jpg)](https://youtu.be/RM7YSlu5ZDg)

* **Creating Automations:**
    [![Creating Automations](https://img.youtube.com/vi/V2tIKgUQYEw/hqdefault.jpg)](https://youtu.be/V2tIKgUQYEw)

* **Meetings Recordings:**
    [![Meetings Recording](https://img.youtube.com/vi/pZrLsoCfUeA/hqdefault.jpg)](https://youtu.be/pZrLsoCfUeA)

* **Facebook Login:**
    [![Facebook Login](https://img.youtube.com/vi/JRhPqCN-jeI/hqdefault.jpg)](https://youtu.be/JRhPqCN-jeI)

* **Facebook Post:**
    [![Facebook Post](https://img.youtube.com/vi/4w6zpz0Rn2o/hqdefault.jpg)](https://youtu.be/4w6zpz0Rn2o)

* **LinkedIn Login & Post:**
    [![LinkedIn Login and Post](https://img.youtube.com/vi/wuD_zefGy2k/hqdefault.jpg)](https://youtu.be/wuD_zefGy2k)
---

## üì∏ Screenshots & GIFs


* **Dashboard View:**
    ![Dashboard View](readme_assets/dashboard_view.png)


* **Automation Configuration UI:**
    ![Automation Configuration](readme_assets/edit_automation.png)

---

## üõ† Tech Stack

* **Backend:** Elixir, Phoenix LiveView
* **Database:** PostgreSQL
* **Background Jobs:** Oban
* **Authentication:** Ueberauth (for Google, LinkedIn, Facebook, HubSpot, Salesforce OAuth)
* **Meeting Transcription:** Recall.ai API
* **AI Content Generation:** Google Gemini API (Flash models)
* **CRM Integrations:** HubSpot API v3, Salesforce REST API v59.0
* **Frontend:** Tailwind CSS, Heroicons (via `tailwind.config.js`)
* **CI/CD:** GitHub Actions (format, compile, test, coverage threshold)
* **Containerisation:** Docker & Docker Compose
* **Testing:** ExUnit, Mox (mock-based), StreamData (property-based)
* **Progress Bar:** Topbar.js for page loading indication.

---

## üöÄ Getting Started

Follow these steps to get SocialScribe running on your local machine.

### Prerequisites

* Elixir
* Erlang/OTP 
* PostgreSQL
* Node.js (for Tailwind CSS asset compilation)

### Setup Instructions

1.  **Clone the Repository:**
    ```bash
    git clone https://github.com/fparadas/social_scribe.git 
    cd social_scribe
    ```

2.  **Install Dependencies & Setup Database:**
    The `mix setup` command bundles common setup tasks.
    ```bash
    mix setup
    ```
    This will typically:
    * Install Elixir dependencies (`mix deps.get`)
    * Create your database if it doesn't exist (`mix ecto.create`)
    * Run database migrations (`mix ecto.migrate`)
    * Install Node.js dependencies for assets (`cd assets && npm install && cd ..`)

3.  **Configure Environment Variables:**
    You'll need to set up several API keys and OAuth credentials.
    * Copy the example environment file (if one is provided, e.g., `.env.example`) to `.env`.
    * Edit the `.env` file (or set environment variables directly) with your actual credentials:
        * `GOOGLE_CLIENT_ID`: Your Google OAuth Client ID.
        * `GOOGLE_CLIENT_SECRET`: Your Google OAuth Client Secret.
        * `GOOGLE_REDIRECT_URI`: `"http://localhost:4000/auth/google/callback"`
        * `RECALL_API_KEY`: Your Recall.ai API Key (as provided for the challenge).
        * `GEMINI_API_KEY`: Your Google Gemini API Key.
        * `LINKEDIN_CLIENT_ID`: Your LinkedIn App Client ID.
        * `LINKEDIN_CLIENT_SECRET`: Your LinkedIn App Client Secret.
        * `LINKEDIN_REDIRECT_URI`: `"http://localhost:4000/auth/linkedin/callback"`
        * `FACEBOOK_APP_ID`: Your Facebook App ID.
        * `FACEBOOK_APP_SECRET`: Your Facebook App Secret.
        * `FACEBOOK_REDIRECT_URI`: `"http://localhost:4000/auth/facebook/callback"`
        * `HUBSPOT_CLIENT_ID`: Your HubSpot App Client ID.
        * `HUBSPOT_CLIENT_SECRET`: Your HubSpot App Client Secret.
        * `HUBSPOT_REDIRECT_URI`: `"http://localhost:4000/auth/hubspot/callback"`
        * `SALESFORCE_CLIENT_ID`: Your Salesforce Connected App Consumer Key.
        * `SALESFORCE_CLIENT_SECRET`: Your Salesforce Connected App Consumer Secret.
        * `SALESFORCE_REDIRECT_URI`: `"http://localhost:4000/auth/salesforce/callback"`

4.  **Start the Phoenix Server:**
    ```bash
    mix phx.server
    ```
    Or, to run inside IEx (Interactive Elixir):
    ```bash
    iex -S mix phx.server
    ```

Now you can visit [`localhost:4000`](http://localhost:4000) from your browser.

### Running with Docker Compose

If you prefer Docker, the project ships with a ready-to-use `docker-compose.yml`:

```bash
# Start PostgreSQL + the Phoenix app
docker-compose up --build

# In another terminal ‚Äî run migrations
docker-compose exec app mix ecto.setup
```

The app will be available at [`localhost:4000`](http://localhost:4000). PostgreSQL is exposed on host port **5433** to avoid conflicts with any local Postgres instance.

To run tests inside Docker:

```bash
docker-compose exec app sh -c \
  'DB_USER=postgres DB_PASSWORD=postgres DB_HOST=db MIX_ENV=test mix test'
```

---

## üß™ Testing

The project has comprehensive test coverage using three approaches:

| Type | Framework | What it covers |
|------|-----------|----------------|
| **Unit tests** | ExUnit + Mox | Contexts, API clients, workers, LiveViews |
| **Property tests** | StreamData | Data transformations, suggestion merging, edge cases |
| **Integration tests** | Phoenix.ConnTest / LiveViewTest | Full page rendering, modal interactions, navigation |

**Important:** All tests use **Mox mocks** for external APIs (HubSpot, Salesforce, Google, Recall.ai, Gemini). No real API keys are needed or used in CI.

Run locally:

```bash
MIX_ENV=test mix test              # all tests
MIX_ENV=test mix test --cover      # with coverage report
```

Current coverage: **~65%** (threshold: 55%).

---

## üîÑ CI/CD Pipeline

GitHub Actions workflow (`.github/workflows/pipeline.yml`) runs on every push to `main`/`develop` and on pull requests:

1. **Check formatting** ‚Äî `mix format --check-formatted`
2. **Compile** ‚Äî `mix compile --warnings-as-errors`
3. **Run tests** ‚Äî `mix test --trace --cover`
4. **Verify coverage threshold** ‚Äî fails the build if total coverage drops below 55%

The pipeline uses PostgreSQL 16 as a service container and caches `deps/` + `_build/` for faster runs.

---

## ‚öôÔ∏è Functionality Deep Dive

* **Connect & Sync:** Users log in with Google. The "Settings" page allows connecting multiple Google accounts, plus LinkedIn and Facebook accounts. For Facebook, after initial connection, users are guided to select a Page for posting. Calendars are synced to a database to populate the dashboard with upcoming events.
* **Record & Transcribe:** On the dashboard, users toggle "Record Meeting?" for desired events. The system extracts meeting links (Zoom, Meet) and uses Recall.ai to dispatch a bot. A background poller (`BotStatusPoller`) checks for completed recordings and transcripts, saving the data to local `Meeting`, `MeetingTranscript`, and `MeetingParticipant` tables.
* **AI Content Generation:**
    * Once a meeting is processed, an `AIContentGenerationWorker` is enqueued.
    * This worker uses Google Gemini to draft a follow-up email.
    * It also processes all active "Automations" defined by the user. For each automation, it combines the meeting data with the user's `prompt_template` and calls Gemini to generate content (e.g., a LinkedIn post), saving it as an `AutomationResult`.
* **Social Posting:**
    * From the "Meeting Details" page, users can view AI-generated email drafts and posts from their automations.
    * "Copy" buttons are available.
    * "Post" buttons allow direct posting to LinkedIn (as the user) and the selected Facebook Page (as the Page).

---

## üîó HubSpot Integration

### HubSpot OAuth Integration

* **Custom Ueberauth Strategy:** Implemented in `lib/ueberauth/strategy/hubspot.ex`
* **OAuth 2.0 Flow:** Handles authorization code flow with HubSpot's `/oauth/authorize` and `/oauth/v1/token` endpoints
* **Credential Storage:** Credentials stored in `user_credentials` table with `provider: "hubspot"`, including `token`, `refresh_token`, and `expires_at`
* **Token Refresh:**
    * `HubspotTokenRefresher` Oban cron worker runs every 5 minutes to proactively refresh tokens expiring within 10 minutes
    * Internal `with_token_refresh/2` wrapper automatically refreshes expired tokens on API calls and retries the request
    * Refresh failures are logged; users are prompted to re-authenticate if refresh token is invalid

### HubSpot Modal UI

* **LiveView Component:** Located at `lib/social_scribe_web/live/meeting_live/hubspot_modal_component.ex`
* **Contact Search:** Debounced input triggers HubSpot API search, results displayed in dropdown
* **AI Suggestions:** Fetched via `HubspotSuggestions.generate_suggestions` which calls Gemini with transcript context
* **Suggestion Cards:** Each card displays:
    * Field label
    * Current value (strikethrough)
    * Arrow
    * Suggested value
    * Timestamp link
* **Selective Updates:** Checkbox per field allows selective updates; "Update HubSpot" button disabled until at least one field selected
* **Form Submission:** Batch-updates selected contact properties via `HubspotApi.update_contact`
* **Click-away Handler:** Closes dropdown without clearing selection
* **Create New Contact:** When no matching contact is found, users can create a new one directly in HubSpot from AI-extracted meeting data

---

## üîó Salesforce Integration

### Salesforce OAuth Integration

* **Custom Ueberauth Strategy:** Implemented in `lib/ueberauth/strategy/salesforce.ex` with a dedicated OAuth2 client in `lib/ueberauth/strategy/salesforce/oauth.ex`
* **OAuth 2.0 Flow:** Handles authorization code flow with Salesforce's standard endpoints, including `instance_url` tracking for API calls
* **Credential Storage:** Credentials stored in `user_credentials` table with `provider: "salesforce"`, including `token`, `refresh_token`, `expires_at`, and `instance_url`
* **Token Refresh:**
    * `SalesforceTokenRefresherWorker` Oban cron worker proactively refreshes tokens approaching expiry
    * Internal `with_token_refresh/2` wrapper automatically handles 401s and retries
    * Note: Salesforce doesn't return a new `refresh_token` on refresh ‚Äî the original stays valid until revoked

### Salesforce Modal UI

* **LiveView Component:** Located at `lib/social_scribe_web/live/meeting_live/salesforce_modal_component.ex`
* **Contact Search:** SOQL-based search across FirstName, LastName, Email, and Account.Name
* **AI Suggestions:** Same pattern as HubSpot ‚Äî Gemini extracts field updates from transcript
* **Create New Contact:** When search returns no results, users can create a contact pre-filled with AI-extracted data
* **Field Mapping:** Internal field names (e.g., `"firstname"`) automatically mapped to Salesforce API names (e.g., `"FirstName"`)

---

## ü§ñ CRM Copilot

The CRM Copilot is an AI-powered chat assistant for interacting with CRM contact data, accessible at `/dashboard/copilot`.

### Architecture

* **Context:** `SocialScribe.CrmCopilot` manages `Session` and `Turn` schemas
* **LiveView:** `CopilotLive.Assistant` handles the full chat interface with real-time updates
* **Multi-CRM search:** `@`-mentioning triggers concurrent searches across all connected CRMs (HubSpot + Salesforce)
* **AI replies:** Powered by `AIContentGeneratorApi.compose_copilot_reply/2` using Google Gemini

### Key Files

| File | Purpose |
|------|---------|
| `lib/social_scribe/crm_copilot.ex` | Context ‚Äî sessions & turns CRUD |
| `lib/social_scribe/crm_copilot/session.ex` | Ecto schema for copilot sessions |
| `lib/social_scribe/crm_copilot/turn.ex` | Ecto schema for chat turns |
| `lib/social_scribe_web/live/copilot_live/assistant.ex` | LiveView logic |
| `lib/social_scribe_web/live/copilot_live/assistant.html.heex` | Chat UI template |
| `assets/js/hooks.js` | `AutoScroller` + `InputAssistant` JS hooks |

---

## üóÇ Project Structure (Key Directories)

```
lib/
‚îú‚îÄ‚îÄ social_scribe/
‚îÇ   ‚îú‚îÄ‚îÄ accounts/              # User & credential schemas
‚îÇ   ‚îú‚îÄ‚îÄ crm_copilot/           # Copilot sessions & turns
‚îÇ   ‚îú‚îÄ‚îÄ workers/               # Oban background jobs
‚îÇ   ‚îú‚îÄ‚îÄ hubspot_api.ex         # HubSpot API client
‚îÇ   ‚îú‚îÄ‚îÄ salesforce_api.ex      # Salesforce API client
‚îÇ   ‚îú‚îÄ‚îÄ hubspot_suggestions.ex # AI suggestion generation (HubSpot)
‚îÇ   ‚îú‚îÄ‚îÄ salesforce_suggestions.ex # AI suggestion generation (Salesforce)
‚îÇ   ‚îî‚îÄ‚îÄ ai_content_generator.ex   # Gemini integration
‚îú‚îÄ‚îÄ social_scribe_web/
‚îÇ   ‚îú‚îÄ‚îÄ live/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ copilot_live/      # CRM Copilot chat interface
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ meeting_live/      # Meeting details + CRM modals
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ automation_live/   # Automation management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ home_live.ex       # Dashboard / calendar view
‚îÇ   ‚îî‚îÄ‚îÄ components/            # Reusable UI components
‚îú‚îÄ‚îÄ ueberauth/strategy/
‚îÇ   ‚îú‚îÄ‚îÄ hubspot.ex             # HubSpot OAuth strategy
‚îÇ   ‚îî‚îÄ‚îÄ salesforce.ex          # Salesforce OAuth strategy
test/
‚îú‚îÄ‚îÄ social_scribe/             # Unit & property tests
‚îî‚îÄ‚îÄ social_scribe_web/live/    # LiveView integration tests
```

---

## ‚ö†Ô∏è Known Issues & Limitations

* **Facebook Posting & App Review:**
    * Posting to Facebook is implemented via the Graph API to a user-managed Page.
    * Full functionality for all users (especially those not app administrators/developers/testers) typically requires a thorough app review process by Meta, potentially including Business Verification. This is standard for apps using Page APIs.
    * During development, posting will be most reliable for app admins to Pages they directly manage.
* **Error Handling & UI Polish:** While core paths are robustly handled, comprehensive error feedback for all API edge cases and advanced UI polish are areas for continued development beyond the initial 48-hour scope.
* **Prompt Templating for Automations:** The current automation prompt templating is basic (string replacement). A more sophisticated templating engine (e.g., EEx or a dedicated library) would be a future improvement.
* **Agenda Integration:** Currently we only sync when the calendar event has a `hangoutLink` or `location` field with a zoom or google meet link.
---

## üë©‚Äçüíª Developer Guide

### Adding a New CRM Integration

1. **Create an Ueberauth strategy** in `lib/ueberauth/strategy/` (see `salesforce.ex` as a template)
2. **Add a behaviour/spec** in `lib/social_scribe/` defining `search_contacts`, `get_contact`, `update_contact`, `create_contact`, `apply_updates`
3. **Implement the API client** with `with_token_refresh/2` for automatic token handling
4. **Add a suggestions module** (see `salesforce_suggestions.ex`) for AI-powered field extraction
5. **Create a modal component** in `lib/social_scribe_web/live/meeting_live/`
6. **Register in the Copilot** ‚Äî update `resolve_crm_sources/1` and `search_single_crm/3` in `assistant.ex`
7. **Add Mox mock** in `test/test_helper.exs` and write tests

### Code Conventions

* **Behaviours for all external APIs** ‚Äî enables Mox-based testing without real API calls
* **`mix format`** must pass before merge (enforced by CI)
* **No real API keys in tests** ‚Äî all external calls go through Mox mocks
* **Property tests** for data transformation functions (suggestion merging, field mapping)

### Useful Commands

```bash
mix format                  # Auto-format all files
mix compile --warnings-as-errors   # Strict compilation
MIX_ENV=test mix test --cover      # Run tests with coverage
mix ecto.migrate            # Apply pending migrations
mix ecto.rollback           # Roll back last migration
```

---

## üìö Learn More (Phoenix Framework)

* Official website: https://www.phoenixframework.org/
* Guides: https://hexdocs.pm/phoenix/overview.html
* Docs: https://hexdocs.pm/phoenix
* Forum: https://elixirforum.com/c/phoenix-forum
* Source: https://github.com/phoenixframework/phoenix